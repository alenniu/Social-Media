<html>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <!-- Trigger/Open The Modal -->

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://www.gstatic.com/firebasejs/5.7.3/firebase.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <style>
        
        /* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
  background-color: #fefefe;
  margin: 5% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 50%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

        
        
        tr:hover {background-color: #f5f5f5;}
        th, td {
            border-bottom: 1px solid #ddd;
        }
    
    </style>
    
   
    
     <center>
    
    <script src="https://www.gstatic.com/firebasejs/5.7.3/firebase.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    
    
    <div id="myNav" class="overlay">

  <!-- Button to close the overlay navigation -->
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>

  <!-- Overlay content -->
  <div class="overlay-content">
    <a id = "profilemenu">Profile</a>
    <a href="#">Explore</a>
    <a href="https://km-software.github.io/Social-Media/aboutus.html">About HIVE</a>
    <a onclick="signout()">Sign Out</a>
  </div>

</div>
    
<style>
button {
  background-color: blue;
  border: none;
  color: white;
  padding: 16px 32px;
  text-align: center;
  font-size: 16px;
  margin: 4px 2px;
  opacity: 0.9;
  transition: 0.3s;
  display: inline-block;
  text-decoration: none;
  cursor: pointer;
}

button:hover {opacity: 1}
</style>
    
<!-- Use any element to open/show the overlay navigation menu -->

       <img id = "opennav" onclick="openNav()" src = "menu.png">  
        
    
         <style>
             #opennav {
                 position: absolute;
                 height: 75px;
                 width:75px;
                 color:transparent;
                 left:20px;
                 top:20px;
                 
             }
             
         </style>
    <br>
    <br>
    
    
    <style>
        
        #menu {
            font-size: 20;
            color: crimson;
            background-color: aqua;
            padding: 4px;
            
    
        }
    /* The Overlay (background) */
.overlay {
  /* Height & width depends on how you want to reveal the overlay (see JS below) */    
  height: 100%;
  width: 0;
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  background-color: rgb(0,0,0); /* Black fallback color */
  background-color: rgba(0,0,0, 0.9); /* Black w/opacity */
  overflow-x: hidden; /* Disable horizontal scroll */
  transition: 0.5s; /* 0.5 second transition effect to slide in or slide down the overlay (height or width, depending on reveal) */
}
/* Position the content inside the overlay */
.overlay-content {
  position: relative;
  top: 25%; /* 25% from the top */
  width: 100%; /* 100% width */
  text-align: center; /* Centered text/links */
  margin-top: 30px; /* 30px top margin to avoid conflict with the close button on smaller screens */
}
/* The navigation links inside the overlay */
.overlay a {
  padding: 8px;
  text-decoration: none;
  font-size: 36px;
  color: #818181;
  display: block; /* Display block instead of inline */
  transition: 0.3s; /* Transition effects on hover (color) */
}
/* When you mouse over the navigation links, change their color */
.overlay a:hover, .overlay a:focus {
  color: #f1f1f1;
}
/* Position the close button (top right corner) */
.overlay .closebtn {
  position: absolute;
  top: 20px;
  right: 45px;
  font-size: 60px;
}
/* When the height of the screen is less than 450 pixels, change the font-size of the links and position the close button again, so they don't overlap */
@media screen and (max-height: 450px) {
  .overlay a {font-size: 20px}
  .overlay .closebtn {
    font-size: 40px;
    top: 15px;
    right: 35px;
  }
}
    </style>
    
        
    <script>
    /* Open when someone clicks on the span element */
function openNav() {
  document.getElementById("myNav").style.width = "100%";
}
/* Close when someone clicks on the "x" symbol inside the overlay */
function closeNav() {
  document.getElementById("myNav").style.width = "0%";
}
    </script>
         
         <!-- The Modal -->

         
    <script>
       
        //var facebookUrl = "";
        
        // Initialize Firebase
        var config = {
    apiKey: "AIzaSyCOqVfQMj1kFydbroIygF9EpclADcRxfz4",
    authDomain: "test-590e7.firebaseapp.com",
    databaseURL: "https://test-590e7.firebaseio.com",
    projectId: "test-590e7",
    storageBucket: "test-590e7.appspot.com",
    messagingSenderId: "50844118454"
        };
        firebase.initializeApp(config);
                
        // Check to see if you are logged in
        firebase.auth().onAuthStateChanged(function(user) {
            if (user == null) {
                alert("Not logged in.");
                signedin = false;
                return;
            } else {
                userId = user.uid;
                name = user.displayName;
                imageUrl = user.photoURL;
                email = user.email;
                    
                // write user data to users
                writeUserData(userId, name, email, imageUrl);
                
                // write data to document
                signedin = true;
                mydiv = document.getElementById("mydata");
                mydiv.innerHTML = name
                myphotodiv = document.getElementById("myphoto");
                myphotodiv.innerHTML = "<img src='" + imageUrl + "'/>";
                document.getElementById("myprofile").innerHTML = "<img src='" + imageUrl + "'/>";
                document.getElementById("name").innerHTML = name;
                document.getElementById("image").src = imageUrl;
                document.getElementById("email").innerHTML = email;
                
                firebase.database().ref('/users').once('value').then(function(snapshot) {
                    var data = (snapshot.val());
                    dataarray = [data]
                users = dataarray[0];
                    
                    for (var u in users) {
                        if (users[u].email == email) {
                            facebookname = users[u].facebook
                            facebookUrl = "https://www.facebook.com/" + facebookname;
                            //alert(facebookUrl);
                        }
                    }
                    
                      for (var u in users) {
                        if (users[u].email == email) {
                            changedusername = users[u].newusername
                            //alert(facebookUrl);
                        }
                    }
                    
                     
                    for (var u in users) {
                        if (users[u].email == email) {
                            newbio = users[u].bio
                            //facebookUrl = "https://www.facebook.com/" + facebookname;
                            //alert(facebookUrl);
                        }
                    }
                    
                     for (var u in users) {
                        if (users[u].email == email) {
                            newschool = users[u].school
                            //facebookUrl = "https://www.facebook.com/" + facebookname;
                            //alert(facebookUrl);
                        }
                    }
                    
                     for (var u in users) {
                        if (users[u].email == email) {
                            twittername = users[u].twitter
                            twitterUrl = "https://twitter.com/" + twittername;
                            //alert(facebookUrl);
                        }
                    }
                    
                });
                
                
                
                firebase.database().ref('/tweets').once('value').then(function(snapshot) {
                    var data = (snapshot.val());
                    if (data == null) {
                      console.log("No data found at /tweets/" + userId);  
                    } else {
                        
                      firebase.database().ref('/users').once('value').then(function(snapshot) { 
                        var userdata = (snapshot.val());
                        if (userdata != null) {
                           dataarray = [data,userdata]
                           console.log(dataarray)
                           updatetweets(dataarray); 
                        }
                      });
                      //console.log(data)
                      //updatetweets(data);
                    }
                });
            } // end user null check
        }); // end check auth state
        
      
        
        function encodeImageFileAsURL() {

            var filesSelected = document.getElementById("inputFileToLoad").files;
            if (filesSelected.length > 0) {
                var fileToLoad = filesSelected[0];
                var fileReader = new FileReader();
                fileReader.onload = function(fileLoadedEvent) {
                    var srcData = fileLoadedEvent.target.result; // <--- data: base64
                    //var newImage = document.createElement('img');
                    //newImage.src = srcData;
                    //document.getElementById("imgTest").innerHTML = newImage.outerHTML;
                    document.getElementById("imgTest").innerHTML = srcData;
                    //console.log("Converted Base64 version is: " + document.getElementById("imgTest").innerHTML);
                    console.log(srcData);
                }
                fileReader.readAsDataURL(fileToLoad);
            }
        } // end function
        
        // write user data
        function writeUserData(userId, name, email, imageUrl) {
            firebase.database().ref('users/' + userId).update({
                username: name,
                email: email,
                profile_picture : imageUrl,
              //  facebook : facebookusername
            });
        }
        
        function updatetweets(data) {
            //var mylist = "<ul>";
            var mytab = "<table>";
            users = data[1]; // put on top, because changed data - not good coding change later
            data = data[0];
            
            for (var u in data) {
                for (var t in data[u]) {
                    mytab = mytab + "<tr>";
                    var date = new Date(data[u][t].time);
                    var time = date.toString();
                    if (data[u][t].img != "") {
                        mytab = mytab + "<td><img src='" + users[u].profile_picture + "' width='50px'></td>";
                        mytab = mytab + "<td>" + users[u].username + "</td>";
                        mytab = mytab + "<td>" + data[u][t].tweet + "</td>";
                        mytab = mytab + "<td>" + time + "<br><img src='" + data[u][t].img + "' width='300px'></td>";
                    } else {
                        mytab = mytab + "<td><img src='" + users[u].profile_picture + "' width='50px'></td>";
                        mytab = mytab + "<td>" + users[u].username + "</td>";
                        mytab = mytab + "<td>" + data[u][t].tweet + "</td>";
                        mytab = mytab + "<td>" + time + "</td>";
                        
                        
                    } 
                    mytab = mytab + "</tr>";
                }   
            }
            //mylist = mylist + "</ul>";
            mytab = mytab + "</table>"
            var mytdiv = document.getElementById("mytweets");
            //mytdiv.innerHTML = mylist;
            mytdiv.innerHTML = mytab;
        }
        
        // write tweets to firebase
        function tweet() {
            
            var twitdoc = document.getElementById("twit");
            var twitimg = document.getElementById("imgTest");
            var nameValue = twitdoc.value;
            var imgValue = twitimg.innerHTML;
            var js_time = Date.now();
            var tweetid = firebase.database().ref('tweets/' + userId + "/").push({tweet: nameValue, time: js_time, img: imgValue});
            twitdoc.value = "";
            console.log("tweet written")
            
            firebase.database().ref('/tweets').once('value').then(function(snapshot) {
                    var data = (snapshot.val());
                    if (data == null) {
                      console.log("No data found at /tweets/" + userId);  
                    } else { 
                        firebase.database().ref('/users').once('value').then(function(snapshot) { 
                        var userdata = (snapshot.val());
                        if (userdata != null) {
                           dataarray = [data,userdata]
                           console.log(dataarray)
                           updatetweets(dataarray); 
                        }
                      });
                    }
                });
            
            
            
            // The unique key stored in tweetid is based on a timestamp, so list items will automatically be ordered chronologically. Because Firebase generates a unique key for each tweet, no write conflicts will occur if multiple users add a post at the same time. https://firebase.google.com/docs/database/admin/save-data
            
        }
        
        function signin() {
            console.log("Signing in");
            var provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithRedirect(provider).then(function(result) { 
                window.location.replace("fbtest.html");
            });
        }
        
        function signout() {
            console.log("Signing out");
            firebase.auth().signOut().then(function() {
            });
        }
        

    
    </script>
         
         <div id = "myBtn">
             <div id = "myprofile">
             
         </div>
         <div id = "profile">
             <p id=yourprofile>
             Your Profile
                 </p>
         </div>
             </div>
         <style>
             
             #yourprofile {
                  background-color: blue;
  border: none;
  color: white;
  padding: 16px 32px;
  text-align: center;
  font-size: 16px;
  margin: 4px 2px;
  opacity: 0.9;
  transition: 0.3s;
  display: inline-block;
  text-decoration: none;
  cursor: pointer;
             }
             #profile {
                  position: absolute;
                 top: 120px;
                 right: 26px;
                 
             }
             
             
             #myprofile {
                 position: relative;
             }
             
             #myprofile img {
                 position: absolute;
                 top: -30px;
                 right: 40px;
                 height: 100px;
                 width: 100px;
             }
         </style>
         
    <div id = "mylogo">
         <a href = "https://km-software.github.io/Social-Media/aboutus.html"><img src = "logo.png"></a>
         
         </div>
             
          <style>
              #mylogo {
              position: absolute;
                 top: 10px;
                 left: 100px;
                 height: 100px;
                 width: 100px;
              }
         </style>
             
             
         

<!-- The Modal -->
         
         
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <div class="card">
  <img  height = "300px" width = "300px" src = "" alt="Image" id="image">
  <h1 id="name"></h1>
  <p id = "newusername1">Make a username in the "Edit Profile" tab!</p>
  <p id = "email"> </p>
  <p id = "bio">Create a bio in the "Edit Profile" tab!</p>
  <p id = "school"> </p>
  
  <a href="#" id = "twitterlink"><i class="fa fa-twitter"></i></a> 

  <a href="" id = "facebooklink"><i class="fa fa-facebook" ></i></a>
        
  <button class="collapsible">Edit Profile</button>
<div class="content">
    <p> Change your Username </p>   
    <textarea rows = "1" cols = "30" id = "newusername">Insert your desired username</textarea>
    <button type="button" onclick="changeusername()">Submit</button>
    <p id = "demo1"> </p>
    
    <p> Change your Bio </p>
    <textarea rows = "3" cols = "30" id = "newbio">Insert your bio here</textarea>
    <button type="button" onclick="bio()">Submit</button>
    <p id = "demo2"> </p>
    
    <p> School </p>
    <textarea rows = "1" cols = "30" id = "newschool">Insert your school here</textarea>
    <button type="button" onclick="school()">Submit</button>
    <p id = "demo3"> </p>
    
  <p> Facebook Username </p>
  <textarea rows = "1" cols = "30" id = "Facebook">Insert your facebook username</textarea>
    <button type="button" onclick="facebook()">Submit</button>
    <p id = demo> </p>
    
    <p> Twitter Username</p>
     <textarea rows = "1" cols = "30" id = "newtwitter">Insert your twitter username</textarea>
    <button type="button" onclick="twitter()">Submit</button>
    <p id = demo4> </p>
    
</div>   
        
        
        
        
  <p><button>Contact</button></p>
</div>
  </div>

</div>

    
        
        
        <button onclick="signin()">Sign in</button>
        
        <br>
       <br>
    
        <form>
            <h3 id = "tweettext">Insert Buzz Below</h3><br>
            <textarea id="twit" type="text" name="thetweet" cols="100" rows="4"></textarea>
        </form> 
        <button type="button" onclick="tweet()">Submit</button>
    
        <br><input id="inputFileToLoad" type="file" onchange="encodeImageFileAsURL();" />
        <div id="imgTest" style="display:none;"></div>
        
    <div id="mytweets"></div>
    <div id="mydata"></div>
    <div id="myphoto"></div>
        
        <style>
            
            #tweettext {
                background-color: blue;
  border: none;
  color: white;
  padding: 16px 32px;
  text-align: center;
  font-size: 16px;
  margin: 4px 2px;
  opacity: 0.9;
  transition: 0.3s;
  display: inline-block;
  text-decoration: none;
  cursor: pointer;
                
                
            }
            
            
        .collapsible {
  background-color: #eee;
  color: #444;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

/* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
.active, .collapsible:hover {
  background-color: #ccc;
}

/* Style the collapsible content. Note: hidden by default */
.content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
}
            
            body {
 background-image: url("beehivebackground.jpg");
 background-color: #cccccc;
height: 100%; 

  /* Center and scale the image nicely */
  background-position: center;
  
  background-size: cover;
}
      </style>  
        
        
    </body>

    
    </center>
    
     <script>
         
         function facebook() {
             
             var face = document.getElementById("Facebook").value;
             facebookname = face;
           //  document.getElementById("demo").innerHTML = face;
             document.getElementById("facebooklink").href = facebookUrl;
             firebase.database().ref('users/' + userId).update({
                facebook : facebookname
            });
             
         }
         
         function twitter() {
              var twit = document.getElementById("newtwitter").value;
             twittername = twit;
           //  document.getElementById("demo").innerHTML = face;
             document.getElementById("twitterlink").href = twitterUrl;
             firebase.database().ref('users/' + userId).update({
                twitter : twittername
            });
         }
         
         function changeusername() {
              var newusername = document.getElementById("newusername").value;
             changedusername = newusername;
               firebase.database().ref('users/' + userId).update({
                newusername : changedusername
             });
             document.getElementById("newusername").innerHTML = changedusername;
             document.getElementById("newusername1").innerHTML = "Username: " + newusername 
         }
         
         function bio() {
              var changedbio = document.getElementById("newbio").value;
             newbio = changedbio;
               firebase.database().ref('users/' + userId).update({
                bio : newbio
             });
             //document.getElementById("demo2").innerHTML = newbio;
             document.getElementById("bio").innerHTML = newbio;
             document.getElementById("newbio").innerHTML = newbio;
            // document.getElementById("newusername1").innerHTML = "Username: " + newusername 
         }
         
         function school() {
             var changedschool = document.getElementById("newschool").value;
             newschool = changedschool;
               firebase.database().ref('users/' + userId).update({
                school : newschool
               });
             document.getElementById("newschool").innerHTML = newschool;
             document.getElementById("school").innerHTML = newschool;
         }
         
         
         var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
    
    // Get the modal
var modal = document.getElementById('myModal');

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
           

// When the user clicks on the button, open the modal 
btn.onclick = function() {
  modal.style.display = "block";
     document.getElementById("facebooklink").href = facebookUrl;
    document.getElementById("Facebook").innerHTML = facebookname;
    document.getElementById("newusername1").innerHTML = "Username: " + changedusername;
    document.getElementById("newusername").innerHTML = changedusername;
    document.getElementById("bio").innerHTML = newbio;
    document.getElementById("newbio").innerHTML = newbio;
    document.getElementById("newschool").innerHTML = newschool;
    document.getElementById("school").innerHTML = newschool;
    document.getElementById("twitterlink").href = twitterUrl;
    document.getElementById("newtwitter").innerHTML = twittername;
}

document.getElementById("profilemenu").onclick = function() {
  modal.style.display = "block";
     document.getElementById("facebooklink").href = facebookUrl;
    document.getElementById("Facebook").innerHTML = facebookname;
    document.getElementById("newusername1").innerHTML = "Username: " + changedusername;
    document.getElementById("newusername").innerHTML = changedusername;
    document.getElementById("bio").innerHTML = newbio;
    document.getElementById("newbio").innerHTML = newbio;
    document.getElementById("newschool").innerHTML = newschool;
    document.getElementById("school").innerHTML = newschool;
    document.getElementById("twitterlink").href = twitterUrl;
    document.getElementById("newtwitter").innerHTML = twittername;
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
    
 

console.log(imageUrl);
console.log(userId);
         
    
    </script>
    
</html>